# Strategies

## Purpose

Test execution strategies that control how property-based tests generate and evaluate test cases.

## Requirements

### Requirement: Strategy Factory

The system SHALL provide a `FluentStrategyFactory` for building customized test strategies using a fluent API.

#### Scenario: Create factory
- **WHEN** `fc.strategy()` is called
- **THEN** a new FluentStrategyFactory instance is returned

#### Scenario: Build strategy
- **WHEN** `.build()` is called on the factory
- **THEN** a configured FluentStrategy instance is returned

### Requirement: Default Strategy

The system SHALL provide a `defaultStrategy()` method that configures a sensible default combination of features.

#### Scenario: Default configuration
- **WHEN** `fc.strategy().defaultStrategy().build()` is called
- **THEN** a strategy with random sampling, deduplication, bias, caching, and shrinking is returned

### Requirement: Sample Size Configuration

The system SHALL provide `withSampleSize(n)` to configure the number of test cases generated.

#### Scenario: Configure sample size
- **WHEN** `.withSampleSize(500)` is called
- **THEN** the strategy generates 500 test cases per arbitrary

#### Scenario: Default sample size
- **WHEN** no sample size is configured
- **THEN** 1000 test cases are generated by default

### Requirement: Random Sampling

The system SHALL provide `withRandomSampling()` to enable random test case generation.

#### Scenario: Enable random sampling
- **WHEN** `.withRandomSampling()` is called
- **THEN** test cases are generated randomly using the configured generator

### Requirement: Deduplication

The system SHALL provide `withoutReplacement()` to ensure unique test cases.

#### Scenario: Enable deduplication
- **WHEN** `.withoutReplacement()` is called
- **THEN** duplicate test cases are not tested

### Requirement: Bias Toward Corner Cases

The system SHALL provide `withBias()` to prioritize corner cases during sampling.

#### Scenario: Enable bias
- **WHEN** `.withBias()` is called
- **THEN** corner cases from arbitraries are tested first

### Requirement: Sample Caching

The system SHALL provide `usingCache()` to cache generated samples.

#### Scenario: Enable caching
- **WHEN** `.usingCache()` is called
- **THEN** generated samples are cached and reused

### Requirement: Shrinking Configuration

The system SHALL provide `withShrinking(shrinkSize?)` to enable counterexample minimization.

#### Scenario: Enable shrinking
- **WHEN** `.withShrinking()` is called
- **THEN** failing test cases are shrunk to find minimal counterexamples
- **AND** the default shrink size of 500 candidates is used

#### Scenario: Configure shrink size
- **WHEN** `.withShrinking(1000)` is called
- **THEN** up to 1000 shrink candidates are tested

### Requirement: Strategy Interface

The system SHALL define a `FluentStrategyInterface` with core methods for test execution.

#### Scenario: hasInput method
- **WHEN** `hasInput(arbitraryName)` is called
- **THEN** it returns whether more test inputs are available for that arbitrary

#### Scenario: getInput method
- **WHEN** `getInput(arbitraryName)` is called
- **THEN** it returns the next test input for that arbitrary

#### Scenario: handleResult method
- **WHEN** `handleResult()` is called
- **THEN** it marks the end of one test iteration

### Requirement: Strategy Composition

The system SHALL support composing strategy features through mixins.

#### Scenario: Combine features
- **WHEN** multiple features like `.withBias().withShrinking().withoutReplacement()` are combined
- **THEN** all features are active in the resulting strategy
